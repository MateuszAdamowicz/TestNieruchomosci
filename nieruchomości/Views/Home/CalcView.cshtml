@using System.Activities.Expressions
@using System.Diagnostics
@using System.Web.Script.Serialization
@using Microsoft.Ajax.Utilities
@using Models.EntityModels
@using Models.ViewModels
@using nieruchomości.Helpers
@using Models.EntityModels
@model Models.ViewModels.CalcViewModel

@{
    ViewBag.Title = "ShowCalc";
}
@*<script src="~/Scripts/jquery-1.10.2.js"></script>*@


<script type="text/javascript">

    var ClatJsonList = @Html.Raw(Json.Encode(Model.ClatList));

    function CalculateAddPrice() {

        var realEstatePrice = +$("#StartCost").val();
        $("#CLAT").val(realEstatePrice * $("#propVatClat").val()/100);

        var addCost = +$("#CLAT").val();

        for (var i = 0; i < ClatJsonList.length; i++)
        {
            var clatItem = ClatJsonList[i];

            if ((realEstatePrice < clatItem.To) && (realEstatePrice >= clatItem.From))
            {
                var temp = (realEstatePrice - clatItem.From) * clatItem.Percent/100;
                if (((temp - clatItem.Max)>0) && (clatItem.Max !== 0)) {
                    $("#Notary").val(clatItem.Max);
                    addCost += +$("#Notary").val();
                    break;
                }
                else
                {
                    $("#Notary").val(temp + clatItem.Price);
                    addCost += +$("#Notary").val();
                    break;
                }
            }
        }

        $("#VATNotary").val($("#Notary").val() * ($("#propVatNotary").val())/100);
        addCost += +$("#VATNotary").val();

        addCost += +$("#CourtFee").val();
        addCost += +$("#KW").val();
        //addCost += +$("#ActPagePrice").val();

        $("#AgencyCommission").val($("#AgencyCommissionPercent").val()/100 * realEstatePrice);
        addCost += +$("#AgencyCommission").val();

        $("#VATAgencyCommission").val($("#AgencyCommission").val() * $("#propVatAgencyCommission").val()/100);
        addCost += +$("#VATAgencyCommission").val();

        $("#ApproxCost").val(addCost);

        $("#TotalCost").val(addCost + realEstatePrice);
    }
</script>

@Html.Hidden("propVatClat", Model.CostPropertiesList.Single(x => x.Type == PropertyType.VatClat).Value, new { @id = "propVatClat" })
@Html.Hidden("propVatNotary", Model.CostPropertiesList.Single(x => x.Type == PropertyType.VatNotary).Value, new { @id = "propVatNotary" })
@Html.Hidden("propVatAgencyCommission", Model.CostPropertiesList.Single(x => x.Type == PropertyType.VatAgencyCommission).Value, new { @id = "propVatAgencyCommission" })

<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">Close</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Kalkulator opłat dodatkowych</h4>
    </div>
    <form class="form-horizontal">
        <div class="modal-body">
            <div class="form-group">
                <label class="control-label col-xs-6">Cena nieruchomości</label>
                <div class="col-xs-6">
                    @*<span class="help glyphicon glyphicon-info-sign" data-toggle="popover" data-placement="right" title="Help info"></span>*@
                    <div class="input-group input-group-sm">
                        <input type="text" value="@Model.ModelCalcView.Price" id="StartCost" name="StartCost" class="form-control" onkeyup="CalculateAddPrice()" placeholder="cena nieruchomości">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label danger col-xs-6">Podatek od czynności cywilnoprawnych</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" readonly="readonly" id="CLAT">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label danger col-xs-6">Taksa notarialna</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" id="Notary" name="Notary" readonly="readonly">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label danger col-xs-6">VAT od taksy notarialnej</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" id="VATNotary" readonly="readonly">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label danger col-xs-6">Opłata sądowa</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" value="@Model.CostPropertiesList.Single(x=>x.Type == PropertyType.CourtFee).Value" id="CourtFee" readonly="readonly">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label danger col-xs-6">Założenie księgi wieczystej</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" id="KW" value="@((Model.ModelCalcView.OwnershipForm == "")?0:@Model.CostPropertiesList.Single(x => x.Type == PropertyType.Mr).Value)" readonly="readonly">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>



            <div class="form-group">
                <label class="control-label danger col-xs-6">Prowizja Agencji</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" value="@Model.CostPropertiesList.Single(x => x.Type == PropertyType.AgencyCommissionPercent).Value" onkeyup="CalculateAddPrice()" id="AgencyCommissionPercent">
                        <span class="input-group-addon">%</span>
                        <input type="number" class="form-control" id="AgencyCommission" readonly="readonly">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label danger col-xs-6">VAT od prowizji agencji</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" id="VATAgencyCommission" readonly="readonly">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>



            @*<div class="form-group">
                    <label class="control-label danger col-xs-6">Wypisy aktu</label>
                    <div class="col-xs-6">
                        <div class="input-group input-group-sm">
                            <input type="number" class="form-control" value="@Model.CostPropertiesList.Single(x => x.Type == PropertyType.ActPagePrice).Value" id="ActPagePrice" readonly="readonly">
                            <span class="input-group-addon">PLN</span>
                        </div>
                    </div>
                </div>*@

            <div class="form-group">
                <label class="control-label danger col-xs-6">Przybliżone koszty dodatkowe</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" id="ApproxCost" readonly="readonly">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label danger col-xs-6">Całkowity koszt nieruchomości</label>
                <div class="col-xs-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" id="TotalCost" readonly="readonly">
                        <span class="input-group-addon">PLN</span>
                    </div>
                </div>
            </div>

        </div>
    </form>
</div>


<script language="javascript">
    window.onload = CalculateAddPrice();
</script>
